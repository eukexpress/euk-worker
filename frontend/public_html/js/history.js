// Layer 2: History logic